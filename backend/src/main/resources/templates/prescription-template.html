<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Ordonnance</title>
    <style>
        /* ==== Mise en page A4 ==== */
        @page { size: A4; margin: 18mm 16mm 20mm 16mm; }
        body { font-family: Arial, "Helvetica Neue", Helvetica, sans-serif; font-size: 12px; color:#222; }

        /* Utiliser des tables pour compat PDF (éviter flex/float) */
        .w-100 { width: 100%; border-collapse: collapse; }
        .muted { color:#666; }
        .small { font-size: 11px; }
        .xs    { font-size: 10px; }
        .right { text-align: right; }
        .center{ text-align: center; }
        .mb-8  { margin-bottom: 8px; }
        .mb-12 { margin-bottom: 12px; }
        .mb-16 { margin-bottom: 16px; }
        .mb-24 { margin-bottom: 24px; }
        .p-12  { padding: 12px; }
        .p-8   { padding: 8px; }
        .b1    { border:1px solid #e5e7eb; }
        .br8   { border-radius: 8px; }

        /* Eviter les coupures de page gênantes */
        .no-break { page-break-inside: avoid; }
        .ligne    { page-break-inside: avoid; }

        /* Titres */
        h1 { font-size: 18px; margin: 0 0 6px 0; }
        h2 { font-size: 14px; margin: 0 0 6px 0; }

        /* Tableau des lignes de prescription */
        table.lignes { width:100%; border-collapse: collapse; }
        table.lignes th, table.lignes td { border:1px solid #e5e7eb; padding:8px; vertical-align: top; }
        table.lignes th { background:#f7f7f7; font-weight: 600; }

        /* En-tête et pied */
        .header, .footer { width:100%; }
        .footer .note { border-top:1px solid #eee; padding-top:6px; }

        /* Image: laisser le moteur gérer la largeur max */
        .logo { max-height: 60px; }
        .signature { max-height: 80px; }

        /* Pastille / boîte d’info */
        .box { border:1px solid #e5e7eb; padding:8px 12px; border-radius:8px; }

        /* QR code (optionnel) */
        .qr { max-height: 100px; }

    </style>
</head>
<body>

<!-- ====== En-tête médecin ====== -->
<table class="header w-100 mb-16 no-break">
    <tr>
        <td style="width:65%;">
            <div style="font-weight:700; font-size:16px;"
                 th:text="${prescription.medecin.prenom + ' ' + prescription.medecin.nom}">Dr Prénom NOM</div>
            <div class="muted" th:if="${prescription.medecin.specialite}"
                 th:text="${prescription.medecin.specialite}">Spécialité</div>
            <div class="small" th:if="${prescription.medecin.adresse}"
                 th:text="${prescription.medecin.adresse}">Adresse du cabinet</div>
            <div class="small" th:if="${prescription.medecin.ville}"
                 th:text="${prescription.medecin.ville}">Ville</div>
            <div class="small" th:if="${prescription.medecin.telephone}"
                 th:text="${'Tél : ' + prescription.medecin.telephone}">Tél : 00 00 00 00 00</div>
            <div class="small" th:if="${prescription.medecin.email}"
                 th:text="${prescription.medecin.email}">email@cabinet.fr</div>
            <div class="small muted" th:if="${prescription.medecin.cin}"
                 th:text="${'CIN : ' + prescription.medecin.cin}">CIN</div>
        </td>
        <td class="right" style="width:35%;">
            <!--<img class="logo" th:if="${prescription.medecin.logoUrl}"
                 th:src="${prescription.medecin.logoUrl}" alt="Logo cabinet"/>-->
            <img class="logo" th:if="${logoSrc}" th:src="${logoSrc}" alt="Logo cabinet"/>
        </td>
    </tr>
</table>

<!-- ====== Titre et méta ordonnance ====== -->
<div class="center mb-12 no-break">
    <h1>ORDONNANCE</h1>
    <div class="muted small">
        <span th:if="${prescription.numeroOrdonnance}"
              th:text="${'N° ' + prescription.numeroOrdonnance}">N° ORD-0001</span>
        <span th:if="${prescription.numeroOrdonnance}">&#160;•&#160;</span>
        <span th:text="${#temporals.format(prescription.date, 'dd/MM/yyyy')}">01/09/2025</span>
        <span th:if="${prescription.dateValidite}">&#160;• Valable jusqu’au&#160;</span>
        <span th:if="${prescription.dateValidite}"
              th:text="${#temporals.format(prescription.dateValidite, 'dd/MM/yyyy')}">01/12/2025</span>
    </div>
</div>

<!-- ====== Infos patient ====== -->
<table class="w-100 mb-16 no-break box">
    <tr>
        <td style="width:60%;">
            <h2>Patient</h2>
            <div>
                <strong th:text="${prescription.patient.prenom + ' ' + prescription.patient.nom}">Prénom NOM</strong>
            </div>
            <div class="small muted" th:if="${prescription.patient.datedenaissance}"
                 th:text="${'Né(e) le ' + #temporals.format(prescription.patient.datedenaissance, 'dd/MM/yyyy')}">
                Né(e) le 12/03/1999
            </div>
            <div class="small" th:if="${prescription.patient.cin}"
                 th:text="${'CIN : ' + prescription.patient.cin}">CIN : XXX</div>
        </td>
        <td style="width:40%;" class="right">
            <div class="small" th:if="${prescription.patient.telephone}"
                 th:text="${'Tél : ' + prescription.patient.telephone}">Tél : --</div>
            <div class="small" th:if="${prescription.patient.email}"
                 th:text="${prescription.patient.email}">email@patient.fr</div>
        </td>
    </tr>
</table>

<!-- ====== Lignes de prescription ====== -->
<div class="mb-16 no-break">
    <h2 class="mb-8">Prescription</h2>
    <table class="lignes">
        <thead>
        <tr>
            <th style="width:30%;">Médicament</th>
            <th style="width:15%;">Dosage</th>
            <th style="width:25%;">Posologie</th>
            <th style="width:10%;">Durée (j)</th>
            <th style="width:20%;">Instructions</th>
        </tr>
        </thead>
        <tbody>
        <tr class="ligne" th:each="l,iter : ${lignes}">
            <td><div th:text="${l.nomMedicament}">Amoxicilline</div></td>
            <td th:text="${l.dosage}">500 mg</td>
            <td th:text="${l.posologie}">2 fois/jour</td>
            <td th:text="${l.duree}">7</td>
            <td><span th:text="${l.instructions}">Après repas</span></td>
        </tr>
        </tbody>
    </table>
</div>

<!-- ====== Signature & QR ====== -->
<table class="w-100 mb-24 no-break">
    <tr>
        <td style="width:60%;">
            <div class="xs muted">Ordonnance établie le
                <span th:text="${#temporals.format(prescription.date, 'dd/MM/yyyy')}">01/09/2025</span>.
            </div>
            <div class="xs muted" th:if="${prescription.dateValidite}">
                Valable jusqu’au <span th:text="${#temporals.format(prescription.dateValidite, 'dd/MM/yyyy')}">01/12/2025</span>.
            </div>
        </td>
        <td class="right" style="width:40%;">
            <div class="small muted">Signature du médecin</div>
            <img class="signature" th:if="${prescription.medecin.signatureUrl}"
                 th:src="${prescription.medecin.signatureUrl}" alt="Signature"/>
        </td>
    </tr>
</table>
<br/><br/>
<br/><br/>


<!-- ====== Pied de page ====== -->
<div class="footer xs muted">
    <div class="note">
        * Médicaments à utiliser conformément aux indications. En cas d’effet indésirable, contactez votre médecin ou pharmacien.
    </div>
    <div>
        <span th:text="${prescription.medecin.nom + ' ' + prescription.medecin.prenom}">Dr NOM Prénom</span>
        — <span th:if="${prescription.medecin.ville}" th:text="${prescription.medecin.ville}">Ville</span>
        — <span th:if="${prescription.medecin.telephone}"
                th:text="${'Tél : ' + prescription.medecin.telephone}">Tél : --</span>
    </div>
</div>

</body>
</html>
